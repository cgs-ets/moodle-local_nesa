{"version":3,"file":"control.min.js","sources":["../src/control.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n// You can use this JS to modify the table after the page loads\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     local_nesa\n * @copyright  2025 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function ($) {\n  return {\n    init: function (nesanumbers) {\n      $(document).ready(function () {\n        // Ensure the table with ID \"user-grades\" exists\n        var table = $('#user-grades');\n        nesanumbers = JSON.parse(nesanumbers);\n\n        if (table.length) {\n          // Find the heading row (tr class=\"heading\")\n          var headingRow = table.find('tr.heading');\n\n          var useremailColumn = headingRow.find('th.userfield.useremail');\n\n          // Get their column indexes\n          var emailIndex = useremailColumn.index();\n\n          // Create NESA column header (without bold)\n          var nesaHeader = $('<th>')\n            .append(\n              $('<span>').attr('data-collapse', 'content').text('NESA number'),\n            )\n            .append(\n              $('<button>')\n                .addClass(\n                  'nesa-number btn btn-link btn-icon icon-size-3 cellmenubtn', //btn btn-link btn-icon icon-size-3 cellmenubtn\n                )\n                .attr({\n                  type: 'button',\n                  'data-toggle': 'dropdown',\n                  'aria-haspopup': 'true',\n                  'aria-expanded': 'false',\n                  'data-type': 'studiescode',\n                  'data-id': 'studiescode',\n                }),\n              // .css('color', '#F8F9FA') // Set the button's color to #F8F9FA\n              // .append(\n              //   $('<i>')\n              //     .addClass('icon fa fa-ellipsis-h fa-fw m-0')\n              //     .attr('title', 'Cell actions')\n              //     .attr('aria-hidden', 'true'),\n              // )\n              // .append($('<span>').addClass('sr-only').text('Cell actions')),\n            )\n            .addClass('userfield studiescode cell c' + emailIndex)\n            .attr({\n              'data-col': 'studiescode',\n              scope: 'col',\n            });\n\n          // Insert the NESA column header in the correct position (before useremail)\n          useremailColumn.before(nesaHeader);\n\n          // Add the NESA column to each row in the tbody\n          table.find('tbody tr').each(function () {\n            // Generate a random number between 0 and 100 for the NESA column\n            var userid = $(this).attr('data-uid');\n            var studiescode =\n              nesanumbers[userid]?.studies_code == undefined\n                ? 'N/A'\n                : nesanumbers[userid]?.studies_code; // the ? makes sure it doesnt\n            // Create the new NESA cell with a div inside\n            var nesaCell = $('<td>')\n              .addClass('userfield studiescode cell c' + emailIndex)\n              .attr('data-col', 'studiescode') // Set the data-col attribute\n              .append(\n                $('<div>')\n                  .attr('data-collapse', 'content') // Add the collapse attribute to the div\n                  .text(studiescode), // Set the random NESA number inside the div\n              );\n\n            // Find the userusername cell and insert the NESA cell before the useremail cell\n            var useremailCell = $(this).find('td.userfield.useremail').first();\n\n            // Insert the NESA cell before the useremail cell\n            useremailCell.before(nesaCell);\n          }, nesanumbers);\n\n          // Adjust the class of the useremail column in the header (shift to next column)\n          headingRow.find('th.userfield.useremail').each(function () {\n            var newClassNumber = emailIndex + 1;\n            $(this)\n              .removeClass('c' + emailIndex)\n              .addClass('c' + newClassNumber);\n          });\n\n          // Adjust the class for the useremail column cells (body rows)\n          table.find('tbody td.userfield.useremail').each(function () {\n            var newClassNumber = emailIndex + 1;\n            $(this)\n              .removeClass('c' + emailIndex)\n              .addClass('c' + newClassNumber);\n          });\n\n          // Shift classes for all columns after useremail in the heading\n          headingRow.find('th').each(function (index) {\n            if (index > emailIndex) {\n              var newClassNumber = index + 1;\n              $(this)\n                .removeClass('c' + (index + 1))\n                .addClass('c' + newClassNumber);\n            }\n          });\n\n          // Shift classes for all columns after useremail in the body rows\n          table.find('tbody td').each(function () {\n            var currentColumnIndex = $(this).index();\n            if (currentColumnIndex > emailIndex) {\n              var newClassNumber = currentColumnIndex + 1;\n              $(this)\n                .removeClass('c' + (currentColumnIndex + 1))\n                .addClass('c' + newClassNumber);\n            }\n          });\n\n          // Change the colspan to adapt to the number of userfield colums.\n          var firstTr = table.find('tr').first();\n          var topLeftCell = firstTr.find('th.cell.topleft.cell.c0');\n\n          var userfieldCount = headingRow.find('th.userfield').length;\n\n          topLeftCell.attr('colspan', userfieldCount + 1); // +1 because the firstname/lastname doesnt have theusefield class\n\n          // Update the colspan for rows after the last userrow\n          var lastUserRow = table.find('tr.userrow').last();\n          var rowsAfterUserRow = lastUserRow.nextAll(); // Get all rows after the last userrow\n\n          // Loop through each of those rows and update the colspan of the th elements\n          rowsAfterUserRow.each(function () {\n            var thElement = $(this).find('th');\n            thElement.attr('colspan', userfieldCount + 1);\n          });\n        }\n      });\n    },\n  };\n});\n"],"names":["define","$","init","nesanumbers","document","ready","table","JSON","parse","length","headingRow","find","useremailColumn","emailIndex","index","nesaHeader","append","attr","text","addClass","type","scope","before","each","userid","this","studiescode","undefined","studies_code","_nesanumbers$userid2","nesaCell","first","newClassNumber","removeClass","currentColumnIndex","topLeftCell","userfieldCount","last","nextAll"],"mappings":";;;;;;;AAyBAA,4BAAO,CAAC,WAAW,SAAUC,SACpB,CACLC,KAAM,SAAUC,aACdF,EAAEG,UAAUC,OAAM,eAEZC,MAAQL,EAAE,mBACdE,YAAcI,KAAKC,MAAML,aAErBG,MAAMG,OAAQ,KAEZC,WAAaJ,MAAMK,KAAK,cAExBC,gBAAkBF,WAAWC,KAAK,0BAGlCE,WAAaD,gBAAgBE,QAG7BC,WAAad,EAAE,QAChBe,OACCf,EAAE,UAAUgB,KAAK,gBAAiB,WAAWC,KAAK,gBAEnDF,OACCf,EAAE,YACCkB,SACC,6DAEDF,KAAK,CACJG,KAAM,uBACS,2BACE,uBACA,oBACJ,wBACF,iBAWhBD,SAAS,+BAAiCN,YAC1CI,KAAK,YACQ,cACZI,MAAO,QAIXT,gBAAgBU,OAAOP,YAGvBT,MAAMK,KAAK,YAAYY,MAAK,wDAEtBC,OAASvB,EAAEwB,MAAMR,KAAK,YACtBS,YACmCC,mCAArCxB,YAAYqB,kEAASI,cACjB,mCACAzB,YAAYqB,+CAAZK,qBAAqBD,aAEvBE,SAAW7B,EAAE,QACdkB,SAAS,+BAAiCN,YAC1CI,KAAK,WAAY,eACjBD,OACCf,EAAE,SACCgB,KAAK,gBAAiB,WACtBC,KAAKQ,cAIQzB,EAAEwB,MAAMd,KAAK,0BAA0BoB,QAG7CT,OAAOQ,YACpB3B,aAGHO,WAAWC,KAAK,0BAA0BY,MAAK,eACzCS,eAAiBnB,WAAa,EAClCZ,EAAEwB,MACCQ,YAAY,IAAMpB,YAClBM,SAAS,IAAMa,mBAIpB1B,MAAMK,KAAK,gCAAgCY,MAAK,eAC1CS,eAAiBnB,WAAa,EAClCZ,EAAEwB,MACCQ,YAAY,IAAMpB,YAClBM,SAAS,IAAMa,mBAIpBtB,WAAWC,KAAK,MAAMY,MAAK,SAAUT,UAC/BA,MAAQD,WAAY,KAClBmB,eAAiBlB,MAAQ,EAC7Bb,EAAEwB,MACCQ,YAAY,KAAOnB,MAAQ,IAC3BK,SAAS,IAAMa,oBAKtB1B,MAAMK,KAAK,YAAYY,MAAK,eACtBW,mBAAqBjC,EAAEwB,MAAMX,WAC7BoB,mBAAqBrB,WAAY,KAC/BmB,eAAiBE,mBAAqB,EAC1CjC,EAAEwB,MACCQ,YAAY,KAAOC,mBAAqB,IACxCf,SAAS,IAAMa,wBAMlBG,YADU7B,MAAMK,KAAK,MAAMoB,QACLpB,KAAK,2BAE3ByB,eAAiB1B,WAAWC,KAAK,gBAAgBF,OAErD0B,YAAYlB,KAAK,UAAWmB,eAAiB,GAG3B9B,MAAMK,KAAK,cAAc0B,OACRC,UAGlBf,MAAK,WACJtB,EAAEwB,MAAMd,KAAK,MACnBM,KAAK,UAAWmB,eAAiB"}