define("local_nesa/control",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Javascript controller for adding Studies Code column to grading tables.
   *
   * @module     local_nesa/control
   * @copyright  2025 Veronica Bermegui
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const setStudiesCodeForUserGradesTable=nesanumbers=>{const table=document.getElementById("user-grades");if(!table)return;const headingRow=table.querySelector("tr.heading");if(!headingRow)return;const useremailColumn=headingRow.querySelector("th.userfield.useremail");if(!useremailColumn)return;const emailIndex=Array.from(headingRow.children).indexOf(useremailColumn),nesaHeader=document.createElement("th");nesaHeader.className="userfield studiescode cell c".concat(emailIndex),nesaHeader.setAttribute("data-col","studiescode"),nesaHeader.setAttribute("scope","col");const spanElement=document.createElement("span");spanElement.setAttribute("data-collapse","content"),spanElement.textContent="Studies Code";const buttonElement=document.createElement("button");buttonElement.className="nesa-number btn btn-link btn-icon icon-size-3 cellmenubtn",buttonElement.setAttribute("type","button"),buttonElement.setAttribute("data-toggle","dropdown"),buttonElement.setAttribute("aria-haspopup","true"),buttonElement.setAttribute("aria-expanded","false"),buttonElement.setAttribute("data-type","studiescode"),buttonElement.setAttribute("data-id","studiescode"),nesaHeader.appendChild(spanElement),nesaHeader.appendChild(buttonElement),useremailColumn.parentNode.insertBefore(nesaHeader,useremailColumn);table.querySelectorAll("tbody tr").forEach((row=>{var _nesanumbers$userid;const userid=row.getAttribute("data-uid"),studiescode=void 0!==(null===(_nesanumbers$userid=nesanumbers[userid])||void 0===_nesanumbers$userid?void 0:_nesanumbers$userid.studies_code)?nesanumbers[userid].studies_code:"N/A",nesaCell=document.createElement("td");nesaCell.className="userfield studiescode cell c".concat(emailIndex),nesaCell.setAttribute("data-col","studiescode");const divElement=document.createElement("div");divElement.setAttribute("data-collapse","content"),divElement.textContent=studiescode,nesaCell.appendChild(divElement);const useremailCell=row.querySelector("td.userfield.useremail");useremailCell&&useremailCell.parentNode.insertBefore(nesaCell,useremailCell)})),headingRow.querySelectorAll("th.userfield.useremail").forEach((th=>{const newClassNumber=emailIndex+1;th.classList.remove("c".concat(emailIndex)),th.classList.add("c".concat(newClassNumber))})),table.querySelectorAll("tbody td.userfield.useremail").forEach((td=>{const newClassNumber=emailIndex+1;td.classList.remove("c".concat(emailIndex)),td.classList.add("c".concat(newClassNumber))}));headingRow.querySelectorAll("th").forEach(((th,index)=>{if(index>emailIndex){const newClassNumber=index+1;th.classList.remove("c".concat(index+1)),th.classList.add("c".concat(newClassNumber))}})),table.querySelectorAll("tbody td").forEach((td=>{const currentColumnIndex=Array.from(td.parentNode.children).indexOf(td);if(currentColumnIndex>emailIndex){const newClassNumber=currentColumnIndex+1;td.classList.remove("c".concat(currentColumnIndex+1)),td.classList.add("c".concat(newClassNumber))}}));const firstTr=table.querySelector("tr"),topLeftCell=null==firstTr?void 0:firstTr.querySelector("th.cell.topleft"),userfieldCount=headingRow.querySelectorAll("th.userfield").length;topLeftCell&&topLeftCell.setAttribute("colspan",userfieldCount+1);const userRows=table.querySelectorAll("tr.userrow"),lastUserRow=userRows[userRows.length-1];if(lastUserRow){let nextSibling=lastUserRow.nextElementSibling;for(;nextSibling;){const thElement=nextSibling.querySelector("th");thElement&&thElement.setAttribute("colspan",userfieldCount+1),nextSibling=nextSibling.nextElementSibling}}};let studiesCodeSortAsc=!0;const sortTableByStudiesCode=(table,columnIndex)=>{const tbody=table.querySelector("tbody");if(!tbody)return;const rows=Array.from(tbody.querySelectorAll("tr"));rows.sort(((a,b)=>{const cellA=a.querySelectorAll("td")[columnIndex],cellB=b.querySelectorAll("td")[columnIndex],valueA=cellA?cellA.textContent.trim():"",valueB=cellB?cellB.textContent.trim():"";if("N/A"===valueA&&"N/A"!==valueB)return 1;if("N/A"===valueB&&"N/A"!==valueA)return-1;const comparison=valueA.localeCompare(valueB,void 0,{numeric:!0,sensitivity:"base"});return studiesCodeSortAsc?comparison:-comparison})),rows.forEach((row=>tbody.appendChild(row))),studiesCodeSortAsc=!studiesCodeSortAsc},setStudiesCodeForSubmissionsTable=nesanumbers=>{const table=document.getElementById("submissions");if(!table)return;const thead=table.querySelector("thead");if(!thead)return;const headingRow=thead.querySelector("tr");if(!headingRow)return;const useremailColumn=headingRow.querySelector("th.email");if(!useremailColumn)return;const emailIndex=Array.from(useremailColumn.parentNode.children).indexOf(useremailColumn),studiesCodeHeader=document.createElement("th");studiesCodeHeader.className="header c".concat(emailIndex," studiescode"),studiesCodeHeader.setAttribute("scope","col"),studiesCodeHeader.style.cursor="pointer";const sortLink=document.createElement("a");sortLink.href="#",sortLink.textContent="Studies Code",sortLink.title="Click to sort by Studies Code",sortLink.style.textDecoration="none",sortLink.style.color="inherit";const sortIcon=document.createElement("span");sortIcon.className="sort-icon",sortIcon.innerHTML=" ↕",sortLink.appendChild(sortIcon),sortLink.addEventListener("click",(e=>{e.preventDefault(),"-1"!==new URL(window.location.href).searchParams.get("perpage")?(()=>{const url=new URL(window.location.href);url.searchParams.set("perpage","-1"),url.searchParams.set("sortbystudiescode","1"),window.location.href=url.toString()})():(sortTableByStudiesCode(table,emailIndex),sortIcon.innerHTML=studiesCodeSortAsc?" ↓":" ↑")})),studiesCodeHeader.appendChild(sortLink),useremailColumn.parentNode.insertBefore(studiesCodeHeader,useremailColumn);const tbodyRows=table.querySelectorAll("tbody tr");tbodyRows.forEach((row=>{var _nesanumbers$userid2;const userClass=row.className.split(" ").find((cls=>cls.startsWith("user")&&"userrow"!==cls)),userid=userClass?userClass.replace("user",""):null,studiescode=userid&&null!==(_nesanumbers$userid2=nesanumbers[userid])&&void 0!==_nesanumbers$userid2&&_nesanumbers$userid2.studies_code?nesanumbers[userid].studies_code:"N/A",studiesCodeCell=document.createElement("td");studiesCodeCell.className="cell c".concat(emailIndex," studiescode"),studiesCodeCell.textContent=studiescode;const useremailCell=row.querySelector("td.email");useremailCell&&useremailCell.parentNode.insertBefore(studiesCodeCell,useremailCell)}));headingRow.querySelectorAll("th").forEach(((th,index)=>{if(index>=emailIndex&&index!==emailIndex){const oldClassMatch=th.className.match(/c(\d+)/);if(oldClassMatch){const oldNum=parseInt(oldClassMatch[1],10);th.classList.remove("c".concat(oldNum)),th.classList.add("c".concat(oldNum+1))}}})),tbodyRows.forEach((row=>{row.querySelectorAll("td").forEach(((td,index)=>{if(index>=emailIndex&&index!==emailIndex){const oldClassMatch=td.className.match(/c(\d+)/);if(oldClassMatch){const oldNum=parseInt(oldClassMatch[1],10);td.classList.remove("c".concat(oldNum)),td.classList.add("c".concat(oldNum+1))}}}))}));const url=new URL(window.location.href);"1"===url.searchParams.get("sortbystudiescode")&&(url.searchParams.delete("sortbystudiescode"),window.history.replaceState({},"",url.toString()),sortTableByStudiesCode(table,emailIndex),sortIcon.innerHTML=studiesCodeSortAsc?" ↓":" ↑")};_exports.init=nesanumbers=>{const parsedNesaNumbers=JSON.parse(nesanumbers);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{setStudiesCodeForUserGradesTable(parsedNesaNumbers),setStudiesCodeForSubmissionsTable(parsedNesaNumbers)})):(setStudiesCodeForUserGradesTable(parsedNesaNumbers),setStudiesCodeForSubmissionsTable(parsedNesaNumbers))}}));

//# sourceMappingURL=control.min.js.map